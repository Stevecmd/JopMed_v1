{% extends "base.html" %}

{% block title %}Checkout - JopMed{% endblock %}

{% block content %}
<div class="checkout-container">
    <h1>Checkout</h1>
    <div id="cart-summary">
        {% for item in cart_items %}
            <div class="cart-item">
                <img src="{{ item.product.image_url if item.product else item.service.image_url }}" alt="{{ item.product.name if item.product else item.service.name }}" class="cart-item-image">
                <div class="cart-item-details">
                    <h3>{{ item.product.name if item.product else item.service.name }}</h3>
                    <p>Quantity: {{ item.quantity }}</p>
                    <p>Price: ${{ "%.2f" | format((item.product.price|float if item.product else item.service.price|float) * item.quantity) }}</p>
                </div>
            </div>
        {% endfor %}
    </div>

    <button id="confirm-purchase" class="btn btn-primary">Confirm Purchase</button>
</div>

<script>
    document.getElementById('confirm-purchase').addEventListener('click', function() {
        fetch('/purchase/confirm', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Purchase successful! Redirecting to receipt...');
                window.location.href = data.receipt_url;
            } else {
                alert('Purchase failed. Please try again.');
            }
        })
        .catch(error => console.error('Error confirming purchase:', error));
    });
</script>
{% endblock %}