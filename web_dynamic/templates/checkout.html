{% extends "base.html" %}

{% block title %}Checkout - JopMed{% endblock %}

{% block content %}
<div class="checkout-container">
    <h1>Checkout</h1>
    <div id="cart-summary">
        {% for item in cart_items %}
            <div class="cart-item">
                <h3>{{ item.product.name if item.product else item.service.name }}</h3>
                <p>Quantity: {{ item.quantity }}</p>
                <p>Price: ${{ (item.product.price if item.product else item.service.price) * item.quantity }}</p>
            </div>
        {% endfor %}
    </div>
    <div id="total-amount">
        <h2>Total: ${{ total_amount }}</h2>
    </div>
    <button id="confirm-purchase">Confirm Purchase</button>
</div>

<script>
    document.getElementById('confirm-purchase').addEventListener('click', function() {
        fetch('http://127.0.0.1:5000/api/purchase/confirm', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Purchase successful! Redirecting to receipt...');
                window.location.href = data.receipt_url;
            } else {
                alert('Purchase failed. Please try again.');
            }
        })
        .catch(error => console.error('Error confirming purchase:', error));
    });
</script>
{% endblock %}